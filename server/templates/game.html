
{%extends 'loggedinheader.html'%}
{% block content %}

<body>
    <!-- Button trigger modal -->
    <button type="button" class="button" data-toggle="modal" data-target="#exampleModalLong">
        DRAFT MY MONSTERS.
    </button>

    <!-- Modal -->
    <div class="modal fade" id="selectHandModal" tabindex="-1" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLongTitle">Welcome to the Monster Draft!</h5>
                </div>
                <div class="modal-body" id="">
                    <div class="container" id="kev">

                    </div>
                    <div class=  "container" id="jake">
                        <p> Select five monsters that you want to draft onto your team before the battle begins.</p>
                        
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-dismiss="modal" id="saveButton" disabled>Save Team</button>
                </div>
            </div>
        </div>
    </div>

   <div id="game-window">
  <form>
    <input type="button" value="New Game" onclick="createGame_io()" />
    <input type="button" value="Wait" onclick="waitState()" />
  </form>
  <div id="game-window">
    <div class="row">
      <div id="left-col" class="leftcolumn">
        <div class="card-deck">
            <div class="card no-bg-border">
                <div class="card-body">
                    <h2 class="text-center">Attacker</h2>
                    <div id="lc1" >
                      
                    </div>
                </div>
            </div>
            <div class="card no-bg-border">
                <div class="card-body">
                    <h2 class="text-center">Defender</h2>
                    <div id="lc2" >
                      
                    </div>
                </div>
            </div>
        </div>
        <div class="card-deck" style="color: black">
            <div class="card">
                <div class="card-header">
                    <h2 class="text-center">Your Hand:</h2>
                </div>
                <div class="card-body">
                    <div class="card-deck" id="monsterHand">

                    </div>
                </div>
            </div>
        </div>
      </div>
      <div class="rightcolumn">
        <div class="message_holder"></div>
        <form action="" method="POST">
          <input type="text" class="username" placeholder="User Name" />
          <input type="text" class="message" placeholder="Messages" style="width: 300px;"/>
          <input type="submit"/>
        </form>
      </div>
    </div> 
  </div>
</body>

<!-- Waiting for players modal -->
<div class="modal fade" id="waitingModal" tabindex="-1" role="dialog">
  <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-body text-center modal-text">
        <div class="fa-3x"><i class="fas fa-circle-notch fa-spin"></i></div>
        <div>
          <p>Waiting for players to join...</p>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  $(document).ready(function () {
      document.addEventListener('game-update', gameUpdate);
      

    $("#waitingModal").modal({
      backdrop: "static", //remove ability to close modal with click
      keyboard: false, //remove option to close with keyboard
      show: false //Display loader!
    });
    $("#selectHandModal").modal({
      backdrop: "static", //remove ability to close modal with click
      keyboard: false, //remove option to close with keyboard
      show: false //Display loader!
    });
      createMonsters()
  });

  function gameUpdate() {
    var state = gameData.state;
    console.log(state);
    switch (state) {
      case "WaitState":
        waitState();
        break;
      case "SelectHandState":
        selectHandState();
        break;
      case "AttackState":
        attackState();
        break;
      case "DefendState":
        defendState();
        break;
      case "VoteState":
        voteState();
        break;
      case "EndState":
        endState();
        break;
      default:
        defaultState();
    }
  }

  function defaultState() {
    // Reset "waitForPlayers" state
    $("#waitingModal").modal('hide');
    $("#selectHandModal").modal('hide');
  }

  function waitState() {
    $("#selectHandModal").modal('hide');
    $("#waitingModal").modal('show');
    document.getElementById("monsterHand").innerHTML = printString;
  }

  function selectHandState() {
    $("#waitingModal").modal('hide');
    $("#selectHandModal").modal('show');
    document.getElementById("monsterHand").innerHTML = printString;
  }
  function attackState() {
      listHand();
  }
  function defendState() {
      listHand();
  }
  function voteState() {
      listHand();
  }
  function endState() {
  }
</script>

<audio id="myAudio">
  <source src="/static/sounds/song.mp3" type="audio/mpeg">
</audio>
<audio id="myAudio2">
  <source src="/static/sounds/ah.mp3" type="audio/mpeg">
</audio>
<audio id="myAudio3">
  <source src="/static/sounds/clinton.mp3" type="audio/mpeg">
</audio>
<audio id="myAudio4">
  <source src="/static/sounds/mac420.mp3" type="audio/mpeg">
</audio>

<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.7.3/socket.io.min.js"></script>
<script src="/static/scripts/game_logic.js"></script>   
<script>
    var monsterChoices = new Array();
    var attackingCard = null;
    var defendingCard = null;
    var names = ["Paul the Cloud", "Not Paul the Cloud", "Ice Cream Dude", "Jelly Dude", "Galusha", "Space Pampootee", "Raccoon", "Spooder Dude", "Fat Zombie Mario", "Badderlocks", "Mike", "Sulley"];
    var locations = ["monsterExample1.JPG", "monsterExample2.JPG", "monsterExample3.JPG", "monsterExample4.JPG", "monsterExample5.JPG", "monsterExample6.JPG", "monsterExample7.JPG", "monsterExample8.JPG", "monsterExample9.JPG", "monsterExample10.JPG", "monster.gif", "scaryMonster.gif"];
   
    socket.on( 'connect', function() {
      socket.emit( 'my event', {
        data: 'User Connected'
      } )
      var form = $( 'form' ).on( 'submit', function( e ) {
        e.preventDefault()
        let user_name = $( 'input.username' ).val()
        let user_input = $( 'input.message' ).val()
        socket.emit( 'my event', {
          user_name : user_name,
          message : user_input
        } )
        $( 'input.message' ).val( '' ).focus()
      } )
    } )
    socket.on( 'my response', function( msg ) {
      console.log( msg )
      if( typeof msg.user_name !== 'undefined' ) {
        $( 'h3' ).remove()
        $( 'div.message_holder' ).append( '<div><b style="color: #000">'+msg.user_name+'</b> '+msg.message+'</div>' )
      }
    })

    function handleMonsterClick(nameString) {
        var index = monsterChoices.indexOf(nameString);
        if (index > -1) {
            monsterChoices.splice(index, 1);
            document.getElementById("kev").innerHTML = "You have chosen: " + monsterChoices.toString() + "\n";
            document.getElementById("saveButton").disabled = true;
        }
        else{
            if (monsterChoices.length >= 5){
                document.getElementById("kev").innerHTML = "You have chosen: " + monsterChoices.toString() + "<br> Your draft is complete, please press 'SAVE TEAM' to prepare your monsters for battle";
            }
            else {
                monsterChoices.push(nameString);
                if (monsterChoices.length >= 5) {
                    document.getElementById("kev").innerHTML = "You have chosen: " + monsterChoices.toString() + "<br> Your draft is complete, please press 'SAVE TEAM' to prepare your monsters for battle";
                    document.getElementById("saveButton").disabled = false;
                }
                else {
                    document.getElementById("kev").innerHTML = "You have chosen: " + monsterChoices.toString() + "\n";
                }
            }
        }
    }
    function createMonsters()
    {
        numCards = names.length;
        if (numCards >= 50) { numCards = 50; }
        var ref = "<p> Select five monsters that you want to draft onto your team before the battle begins.</p>";
        for (var kasey = 0; kasey < numCards; kasey++) {
            var monster_name = names[kasey];
            var pictureName = locations[kasey];
            ref = ref + `<button onclick="handleMonsterClick('${monster_name}')"><img src="/static/images/${pictureName}" width="125px" height="215px"></button>`
        }
        document.getElementById("jake").innerHTML = ref;
    }
    function listHand() {
        numCards = monsterChoices.length;
        printString = '<br>'
        for (var i = 0; i < numCards; i++)
        {
            monster_name = monsterChoices[i]
            index = names.indexOf(monster_name)
            pictureName = locations[index]
            
            printString = printString + `<div class="card" style="display: inline-block; max-width:200px; color:#255760";> <img class="card-img-top" src="/static/images/${pictureName}"> <div class="card-body"> <button onclick="handleHandClick('${monster_name}')">${monster_name}</button> </div> </div>`;
        }
        document.getElementById("monsterHand").innerHTML = printString ;
    }
    function handleHandClick(nameString) {
        if (gameData.state == "AttackState") {
            attackingCard = nameString;
            document.getElementById("lc1").innerHTML = nameString;
        }
        if (gameData.state == "DefendState") { defendingCard = nameString; }
    }
</script>
{% endblock %}

